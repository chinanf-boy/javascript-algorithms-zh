
# 布隆过滤器

布隆过滤器可以用于检索一个元素是否在一个集合中. 它的优点是空间效率和查询时间都远远超过一般的算法，缺点是有一定的误识别率和删除困难. 

布隆过滤器的原理是，当一个元素被加入集合时，通过K个散列函数将这个元素映射成一个位数组中的K个点，把它们置为1. 检索时，我们只要看看这些点是不是都是1就（大约）知道集合中有没有它了：如果这些点有任何一个0，则被检元素一定不在；如果都是1，则被检元素很可能在. 这就是布隆过滤器的基本思想. 

## 算法描述

空过滤器可以是一个`m`位数组,全部设置为`0`. 还必须有`k`个不同的哈希函数,每个哈希函数将一些 集合元素 映射或哈希 到`m`阵列其中一个位置,产生均匀的随机分布. 

通常情况下,`k`是一个常数,远小于`m`,与要添加的元素数量成正比; 精确的选择`k`和`m`的比例常数是,由 过滤器的预期误报率 决定. 

以下是过滤器的示例,彩色箭头显示 `{x, y, z}`集合的 元素映射到的位数组中的位置. 而元素`w`不在集合中,因为它哈希到包含的一个位数组位置`0`. 对于这个例子来说,`m = 18`和`k = 3`. 

![Bloom Filter](https://upload.wikimedia.org/wikipedia/commons/a/ac/Bloom_filter.svg)

## 操作

过滤器可以执行两个主要操作: *插入*和*搜索*. 搜索可能会导致误报. 删除是不可能的. 

换句话说,过滤器可以接收项目. 当我们去检查某个项目之前是否已被插入时,它可以告诉我们"不"或"可能". 

插入和搜索都是`O(1)`操作. 

## 制作过滤器

通过分配特定大小,来创建布隆过滤器. 在我们的例子中,我们使用`100`作为默认长度. 所有位置都初始化为`false`. 

### 插入

在插入过程中,是可以有许多哈希函数,而在我们的例子中有`3`哈希函数,用于创建输入的哈希值. 这些哈希函数输出索引. 在收到的每个索引处,我们只需将 过滤器中的值更改为`true`. 

### 搜索

在搜索期间,调用相同的哈希函数用于哈希输入. 然后我们检查是否收到了索引中的*所有*值都是`true`,在我们的布隆过滤器内如果他们*所有*为`true`,我们知道布隆过滤器可能具有先前插入的值. 

但是,它不确定,因为之前插入的其他值可能会将值翻转到`true`. 对当前正在搜索的项目来说,绝对确定是不可能的,除非之前只插入了一个项目. 

在检查过滤器以查找由哈希函数返回的索引时,哪怕一个值是`false`,我们就明确知道该项目以前没有插入. 

## 误报

误报的概率由三个因素决定: 布隆过滤器的大小,我们使用的哈希函数的数量,以及 已插入过滤器的项目数. 

计算 假阳性 可能性的公式是: 

 ( 1 - e <sup>-kn/m</sup> ) <sup>k</sup>

`k` = 哈希函数的数量

`m` = 过滤器大小

`n` = 插入的项目数

这些变量,`k`,`m`,和`n`,应根据 误报的可接受程度 来挑选. 如果选择了值并且得到的概率太高,则应调整这些值并重新计算概率. 

## 应用

可以在博客网站上使用 布隆过滤器. 如果目的是向读者展示他们以前从未见过的文章,那么布隆过滤器是完美的. 它可以根据文章存储哈希值. 在用户阅读几篇文章后,可以将它们插入到过滤器中. 用户下次访问该网站时,可以从结果中过滤掉这些文章. 

有些文章不可避免地会被错误地过滤掉,但成本是可以接受的. 如果用户从未看到过一些文章,只要他们每次访问该网站时都有其他全新的文章,那就没问题了. 

## 参考

-   [Wikipedia](https://en.wikipedia.org/wiki/Bloom_filter)
-   [Bloom Filters by Example](http://llimllib.github.io/bloomfilter-tutorial/)
-   [Calculating False Positive Probability](https://hur.st/bloomfilter/?n=4&p=&m=18&k=3)
-   [Bloom Filters on Medium](https://blog.medium.com/what-are-bloom-filters-1ec2a50c68ff)
-   [Bloom Filters on YouTube](https://www.youtube.com/watch?v=bEmBh1HtYrw)
-   [数学之美系列二十一 － 布隆过滤器（Bloom Filter](https://china.googleblog.com/2007/07/bloom-filter_7469.html)
